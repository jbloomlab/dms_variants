
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>ispline &#8212; dms_variants 1.4.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pdb_utils" href="dms_variants.pdb_utils.html" />
    <link rel="prev" title="illuminabarcodeparser" href="dms_variants.illuminabarcodeparser.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <span class="target" id="module-dms_variants.ispline"></span><section id="ispline">
<h1>ispline<a class="headerlink" href="#ispline" title="Permalink to this headline">¶</a></h1>
<p>Implements <a class="reference internal" href="#dms_variants.ispline.Isplines" title="dms_variants.ispline.Isplines"><code class="xref py py-class docutils literal notranslate"><span class="pre">Isplines</span></code></a>, which are monotonic spline functions that are
defined in terms of <a class="reference internal" href="#dms_variants.ispline.Msplines" title="dms_variants.ispline.Msplines"><code class="xref py py-class docutils literal notranslate"><span class="pre">Msplines</span></code></a>. Also implements <a class="reference internal" href="#dms_variants.ispline.Isplines_total" title="dms_variants.ispline.Isplines_total"><code class="xref py py-class docutils literal notranslate"><span class="pre">Isplines_total</span></code></a>
for the weighted sum of a <a class="reference internal" href="#dms_variants.ispline.Isplines" title="dms_variants.ispline.Isplines"><code class="xref py py-class docutils literal notranslate"><span class="pre">Isplines</span></code></a> family.</p>
<p>See <a class="reference external" href="https://www.jstor.org/stable/2245395">Ramsay (1988)</a> for details about these splines, and also note the
corrections in the <a class="reference external" href="http://www.fon.hum.uva.nl/praat/manual/spline.html">Praat manual</a> to the errors in the I-spline formula
by <a class="reference external" href="https://www.jstor.org/stable/2245395">Ramsay (1988)</a>.</p>
<dl class="py class">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">dms_variants.ispline.</span></span><span class="sig-name descname"><span class="pre">Isplines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mesh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/dms_variants/ispline.html#Isplines"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dms_variants.ispline.Isplines" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Implements I-splines (see <a class="reference external" href="https://www.jstor.org/stable/2245395">Ramsay (1988)</a>).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>order</strong> (<em>int</em>) – Sets <a class="reference internal" href="#dms_variants.ispline.Isplines.order" title="dms_variants.ispline.Isplines.order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines.order</span></code></a>.</p></li>
<li><p><strong>mesh</strong> (<em>array-like</em>) – Sets <a class="reference internal" href="#dms_variants.ispline.Isplines.mesh" title="dms_variants.ispline.Isplines.mesh"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines.mesh</span></code></a>.</p></li>
<li><p><strong>x</strong> (<em>numpy.ndarray</em>) – Sets <a class="reference internal" href="#dms_variants.ispline.Isplines.x" title="dms_variants.ispline.Isplines.x"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines.x</span></code></a>.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines.order">
<span class="sig-name descname"><span class="pre">order</span></span><a class="headerlink" href="#dms_variants.ispline.Isplines.order" title="Permalink to this definition">¶</a></dt>
<dd><p>Order of spline, <span class="math notranslate nohighlight">\(k\)</span> in notation of <a class="reference external" href="https://www.jstor.org/stable/2245395">Ramsay (1988)</a>. Note that
the degree of the I-spline is equal to <span class="math notranslate nohighlight">\(k\)</span>, while the
associated M-spline has order <span class="math notranslate nohighlight">\(k\)</span> but degree <span class="math notranslate nohighlight">\(k - 1\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines.mesh">
<span class="sig-name descname"><span class="pre">mesh</span></span><a class="headerlink" href="#dms_variants.ispline.Isplines.mesh" title="Permalink to this definition">¶</a></dt>
<dd><p>Mesh sequence, <span class="math notranslate nohighlight">\(\xi_1 &lt; \ldots &lt; \xi_q\)</span> in the notation
of <a class="reference external" href="https://www.jstor.org/stable/2245395">Ramsay (1988)</a>. This class implements <strong>fixed</strong> mesh sequences.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines.n">
<span class="sig-name descname"><span class="pre">n</span></span><a class="headerlink" href="#dms_variants.ispline.Isplines.n" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of members in spline, denoted as <span class="math notranslate nohighlight">\(n\)</span> in <a class="reference external" href="https://www.jstor.org/stable/2245395">Ramsay (1988)</a>.
Related to number of points <span class="math notranslate nohighlight">\(q\)</span> in the mesh and the order
<span class="math notranslate nohighlight">\(k\)</span> by <span class="math notranslate nohighlight">\(n = q - 2 + k\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines.lower">
<span class="sig-name descname"><span class="pre">lower</span></span><a class="headerlink" href="#dms_variants.ispline.Isplines.lower" title="Permalink to this definition">¶</a></dt>
<dd><p>Lower end of interval spanned by the splines (first point in mesh).</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines.upper">
<span class="sig-name descname"><span class="pre">upper</span></span><a class="headerlink" href="#dms_variants.ispline.Isplines.upper" title="Permalink to this definition">¶</a></dt>
<dd><p>Upper end of interval spanned by the splines (last point in mesh).</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The methods of this class cache their results and return immutable
numpy arrays. Do <strong>not</strong> make these arrays mutable and change their
values, as this will lead to invalid caching.</p>
</div>
<p class="rubric">Example</p>
<p>Short examples to demonstrate and test <a class="reference internal" href="#dms_variants.ispline.Isplines" title="dms_variants.ispline.Isplines"><code class="xref py py-class docutils literal notranslate"><span class="pre">Isplines</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">itertools</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy.optimize</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dms_variants.ispline</span> <span class="kn">import</span> <span class="n">Isplines</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">order</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mesh</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.99999</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">isplines</span> <span class="o">=</span> <span class="n">Isplines</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">isplines</span><span class="o">.</span><span class="n">order</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">isplines</span><span class="o">.</span><span class="n">mesh</span>
<span class="go">array([0. , 0.3, 0.5, 0.6, 1. ])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">isplines</span><span class="o">.</span><span class="n">n</span>
<span class="go">6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">isplines</span><span class="o">.</span><span class="n">lower</span>
<span class="go">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">isplines</span><span class="o">.</span><span class="n">upper</span>
<span class="go">1.0</span>
</pre></div>
</div>
<p>Evaluate the I-splines at some selected points:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">isplines</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;I</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">isplines</span><span class="o">.</span><span class="n">I</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">... </span>
<span class="go">I1: [0.   0.96 1.   1.   1.   1.  ]</span>
<span class="go">I2: [0.   0.52 0.84 0.98 1.   1.  ]</span>
<span class="go">I3: [0.   0.09 0.3  0.66 1.   1.  ]</span>
<span class="go">I4: [0.   0.   0.   0.02 0.94 1.  ]</span>
<span class="go">I5: [0.   0.   0.   0.   0.58 1.  ]</span>
<span class="go">I6: [0.   0.   0.   0.   0.13 1.  ]</span>
</pre></div>
</div>
<p>Check that gradients are correct for <a class="reference internal" href="#dms_variants.ispline.Isplines.dI_dx" title="dms_variants.ispline.Isplines.dI_dx"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Isplines.dI_dx()</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xval</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">isplines</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">xval</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xval</span><span class="p">])</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">xval</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">Isplines</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">xval</span><span class="p">)</span><span class="o">.</span><span class="n">I</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">dfunc</span><span class="p">(</span><span class="n">xval</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">Isplines</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">xval</span><span class="p">)</span><span class="o">.</span><span class="n">dI_dx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">err</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">check_grad</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">dfunc</span><span class="p">,</span> <span class="n">xval</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">err</span> <span class="o">&gt;</span> <span class="mf">1e-5</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;excess err </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">xval</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Plot the I-splines in Fig. 1 of <a class="reference external" href="https://www.jstor.org/stable/2245395">Ramsay (1988)</a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">xplot</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">isplines_xplot</span> <span class="o">=</span> <span class="n">Isplines</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">xplot</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">xplot</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">isplines</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;I</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">isplines_xplot</span><span class="o">.</span><span class="n">I</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//dms_variants-ispline-1.png">png</a>, <a class="reference external" href=".//dms_variants-ispline-1.hires.png">hires.png</a>, <a class="reference external" href=".//dms_variants-ispline-1.pdf">pdf</a>)</p>
<figure class="align-default">
<img alt="_images/dms_variants-ispline-1.png" class="plot-directive" src="_images/dms_variants-ispline-1.png" />
</figure>
<dl class="py method">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines.I">
<span class="sig-name descname"><span class="pre">I</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/dms_variants/ispline.html#Isplines.I"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dms_variants.ispline.Isplines.I" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate spline <span class="math notranslate nohighlight">\(I_i\)</span> at point(s) <a class="reference internal" href="#dms_variants.ispline.Isplines.x" title="dms_variants.ispline.Isplines.x"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines.x</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>i</strong> (<em>int</em>) – Spline member <span class="math notranslate nohighlight">\(I_i\)</span>, where <span class="math notranslate nohighlight">\(1 \le i \le\)</span>
<a class="reference internal" href="#dms_variants.ispline.Isplines.n" title="dms_variants.ispline.Isplines.n"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines.n</span></code></a>.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The values of the I-spline at each point in <a class="reference internal" href="#dms_variants.ispline.Isplines.x" title="dms_variants.ispline.Isplines.x"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines.x</span></code></a>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The spline is evaluated using the formula given in the
<a class="reference external" href="http://www.fon.hum.uva.nl/praat/manual/spline.html">Praat manual</a>, which corrects some errors in the formula
provided by <a class="reference external" href="https://www.jstor.org/stable/2245395">Ramsay (1988)</a>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}I_i\left(x\right)
=
\begin{cases}
0 &amp; \rm{if\;} i &gt; j, \\
1 &amp; \rm{if\;} i &lt; j - k, \\
\sum_{m=i+1}^j \left(t_{m+k+1} - t_m\right)
               M_m\left(x \mid k + 1\right) / \left(k + 1 \right)
  &amp; \rm{otherwise},
\end{cases}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(j\)</span> is the index such that <span class="math notranslate nohighlight">\(t_j \le x &lt; t_{j+1}\)</span>
(the <span class="math notranslate nohighlight">\(\left\{t_j\right\}\)</span> are the <a class="reference internal" href="#dms_variants.ispline.Msplines.knots" title="dms_variants.ispline.Msplines.knots"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Msplines.knots</span></code></a> for a
M-spline of order <span class="math notranslate nohighlight">\(k + 1\)</span>) and <span class="math notranslate nohighlight">\(k\)</span> is
<a class="reference internal" href="#dms_variants.ispline.Isplines.order" title="dms_variants.ispline.Isplines.order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines.order</span></code></a>.</p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines.dI_dx">
<span class="sig-name descname"><span class="pre">dI_dx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/dms_variants/ispline.html#Isplines.dI_dx"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dms_variants.ispline.Isplines.dI_dx" title="Permalink to this definition">¶</a></dt>
<dd><p>Derivative of <a class="reference internal" href="#dms_variants.ispline.Isplines.I" title="dms_variants.ispline.Isplines.I"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Isplines.I()</span></code></a> by <a class="reference internal" href="#dms_variants.ispline.Isplines.x" title="dms_variants.ispline.Isplines.x"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines.x</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>i</strong> (<em>int</em>) – Same meaning as for <a class="reference internal" href="#dms_variants.ispline.Isplines.I" title="dms_variants.ispline.Isplines.I"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Isplines.I()</span></code></a>.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Derivative of I-spline with respect to <a class="reference internal" href="#dms_variants.ispline.Isplines.x" title="dms_variants.ispline.Isplines.x"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines.x</span></code></a>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The derivative is calculated from the equation in <a class="reference internal" href="#dms_variants.ispline.Isplines.I" title="dms_variants.ispline.Isplines.I"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Isplines.I()</span></code></a>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{\partial I_i\left(x\right)}{\partial x}
=
\begin{cases}
0 &amp; \rm{if\;} i &gt; j \rm{\; or \;} i &lt; j - k, \\
\sum_{m=i+1}^j\left(t_{m+k+1} - t_m\right)
              \frac{\partial M_m\left(x \mid k+1\right)}{\partial x}
              \frac{1}{k + 1}
  &amp; \rm{otherwise}.
\end{cases}\end{split}\]</div>
</div>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines.j">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">j</span></span><a class="headerlink" href="#dms_variants.ispline.Isplines.j" title="Permalink to this definition">¶</a></dt>
<dd><p><span class="math notranslate nohighlight">\(j\)</span> as defined in <a class="reference internal" href="#dms_variants.ispline.Isplines.I" title="dms_variants.ispline.Isplines.I"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Isplines.I()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines.x">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">x</span></span><a class="headerlink" href="#dms_variants.ispline.Isplines.x" title="Permalink to this definition">¶</a></dt>
<dd><p>Points at which spline is evaluated.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines_total">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">dms_variants.ispline.</span></span><span class="sig-name descname"><span class="pre">Isplines_total</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mesh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/dms_variants/ispline.html#Isplines_total"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dms_variants.ispline.Isplines_total" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Evaluate the weighted sum of an I-spline family (see <a class="reference external" href="https://www.jstor.org/stable/2245395">Ramsay (1988)</a>).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>order</strong> (<em>int</em>) – Sets <a class="reference internal" href="#dms_variants.ispline.Isplines_total.order" title="dms_variants.ispline.Isplines_total.order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines_total.order</span></code></a>.</p></li>
<li><p><strong>mesh</strong> (<em>array-like</em>) – Sets <a class="reference internal" href="#dms_variants.ispline.Isplines_total.mesh" title="dms_variants.ispline.Isplines_total.mesh"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines_total.mesh</span></code></a>.</p></li>
<li><p><strong>x</strong> (<em>numpy.ndarray</em>) – Sets <a class="reference internal" href="#dms_variants.ispline.Isplines_total.x" title="dms_variants.ispline.Isplines_total.x"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines_total.x</span></code></a>.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines_total.order">
<span class="sig-name descname"><span class="pre">order</span></span><a class="headerlink" href="#dms_variants.ispline.Isplines_total.order" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#dms_variants.ispline.Isplines.order" title="dms_variants.ispline.Isplines.order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines.order</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines_total.mesh">
<span class="sig-name descname"><span class="pre">mesh</span></span><a class="headerlink" href="#dms_variants.ispline.Isplines_total.mesh" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#dms_variants.ispline.Isplines.mesh" title="dms_variants.ispline.Isplines.mesh"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines.mesh</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines_total.n">
<span class="sig-name descname"><span class="pre">n</span></span><a class="headerlink" href="#dms_variants.ispline.Isplines_total.n" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#dms_variants.ispline.Isplines.n" title="dms_variants.ispline.Isplines.n"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines.n</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines_total.lower">
<span class="sig-name descname"><span class="pre">lower</span></span><a class="headerlink" href="#dms_variants.ispline.Isplines_total.lower" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#dms_variants.ispline.Isplines.lower" title="dms_variants.ispline.Isplines.lower"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines.lower</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines_total.upper">
<span class="sig-name descname"><span class="pre">upper</span></span><a class="headerlink" href="#dms_variants.ispline.Isplines_total.upper" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference internal" href="#dms_variants.ispline.Isplines.upper" title="dms_variants.ispline.Isplines.upper"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines.upper</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Evaluates the full interpolating curve from the I-splines. When
<span class="math notranslate nohighlight">\(x\)</span> falls within the lower <span class="math notranslate nohighlight">\(L\)</span> and upper <span class="math notranslate nohighlight">\(U\)</span>
bounds of the range covered by the I-splines (<span class="math notranslate nohighlight">\(L \le x \le U\)</span>),
then this curve is defined as:</p>
<div class="math notranslate nohighlight">
\[I_{\rm{total}}\left(x\right)
=
w_{\rm{lower}} + \sum_i w_i I_i\left(x\right).\]</div>
<p>When <span class="math notranslate nohighlight">\(x\)</span> is outside the range of the mesh covered by the splines,
the values are linearly extrapolated from first derivative at the
bounds. Specifically, if <span class="math notranslate nohighlight">\(x &lt; L\)</span> then:</p>
<div class="math notranslate nohighlight">
\[I_{\rm{total}}\left(x\right)
=
I_{\rm{total}}\left(L\right) +
\left(x - L\right)
\left.\frac{\partial I_{\rm{total}}\left(y\right)}
           {\partial y}\right\rvert_{y=L},\]</div>
<p>and if <span class="math notranslate nohighlight">\(x &gt; U\)</span> then:</p>
<div class="math notranslate nohighlight">
\[I_{\rm{total}}\left(x\right)
=
I_{\rm{total}}\left(U\right) +
\left(x - U\right)
\left.\frac{\partial I_{\rm{total}}\left(y\right)}
           {\partial y}\right\rvert_{y=U}.\]</div>
<p>Note also that:</p>
<div class="math notranslate nohighlight">
\[\begin{split}I_{\rm{total}}\left(L\right) &amp;=&amp; w_{\rm{lower}}, \\
I_{\rm{total}}\left(U\right) &amp;=&amp; w_{\rm{lower}} + \sum_i w_i\end{split}\]</div>
</div>
<p class="rubric">Example</p>
<p>Short examples to demonstrate and test <a class="reference internal" href="#dms_variants.ispline.Isplines_total" title="dms_variants.ispline.Isplines_total"><code class="xref py py-class docutils literal notranslate"><span class="pre">Isplines_total</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">itertools</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy.optimize</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dms_variants.ispline</span> <span class="kn">import</span> <span class="n">Isplines_total</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">order</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mesh</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.99999</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">isplines_total</span> <span class="o">=</span> <span class="n">Isplines_total</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">weights</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">isplines_total</span><span class="o">.</span><span class="n">Itotal</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">w_lower</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">array([0.  , 0.38, 0.54, 0.66, 1.21, 1.43])</span>
</pre></div>
</div>
<p>Now calculate using some points that require linear extrapolation
outside the mesh and also have a nonzero <cite>w_lower</cite>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">isplines_total2</span> <span class="o">=</span> <span class="n">Isplines_total</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">isplines_total2</span><span class="o">.</span><span class="n">Itotal</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">w_lower</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">array([0.   , 0.5  , 1.   , 1.02 , 2.433, 2.433])</span>
</pre></div>
</div>
<p>Test <a class="reference internal" href="#dms_variants.ispline.Isplines_total.dItotal_dx" title="dms_variants.ispline.Isplines_total.dItotal_dx"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Isplines_total.dItotal_dx()</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x_deriv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">xval</span> <span class="ow">in</span> <span class="n">x_deriv</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">xval</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xval</span><span class="p">])</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">xval</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">Isplines_total</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">xval</span><span class="p">)</span><span class="o">.</span><span class="n">Itotal</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">dfunc</span><span class="p">(</span><span class="n">xval</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">Isplines_total</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">xval</span><span class="p">)</span><span class="o">.</span><span class="n">dItotal_dx</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">err</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">check_grad</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">dfunc</span><span class="p">,</span> <span class="n">xval</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">err</span> <span class="o">&gt;</span> <span class="mf">1e-5</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;excess err </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">xval</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">isplines_total</span><span class="o">.</span><span class="n">dItotal_dw_lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Test <a class="reference internal" href="#dms_variants.ispline.Isplines_total.dItotal_dweights" title="dms_variants.ispline.Isplines_total.dItotal_dweights"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Isplines_total.dItotal_dweights()</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">isplines_total3</span> <span class="o">=</span> <span class="n">Isplines_total</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">x_deriv</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wl</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">isplines_total3</span><span class="o">.</span><span class="n">dItotal_dweights</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">wl</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span>
<span class="gp">... </span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_deriv</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)))</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">weightslist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">iw</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_deriv</span><span class="p">)),</span>
<span class="gp">... </span>                                <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">))):</span>
<span class="gp">... </span>    <span class="n">w</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">weightslist</span><span class="p">[</span><span class="n">iw</span><span class="p">]])</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">iweights</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weightslist</span><span class="p">[:</span> <span class="n">iw</span><span class="p">]</span> <span class="o">+</span>
<span class="gp">... </span>                               <span class="nb">list</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">+</span>
<span class="gp">... </span>                               <span class="n">weightslist</span><span class="p">[</span><span class="n">iw</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">isplines_total3</span><span class="o">.</span><span class="n">Itotal</span><span class="p">(</span><span class="n">iweights</span><span class="p">,</span> <span class="n">wl</span><span class="p">)[</span><span class="n">ix</span><span class="p">]</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">dfunc</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">iweights</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weightslist</span><span class="p">[:</span> <span class="n">iw</span><span class="p">]</span> <span class="o">+</span>
<span class="gp">... </span>                               <span class="nb">list</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">+</span>
<span class="gp">... </span>                               <span class="n">weightslist</span><span class="p">[</span><span class="n">iw</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:])</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">isplines_total3</span><span class="o">.</span><span class="n">dItotal_dweights</span><span class="p">(</span><span class="n">iweights</span><span class="p">,</span> <span class="n">wl</span><span class="p">)[</span><span class="n">ix</span><span class="p">,</span>
<span class="gp">... </span>                                                              <span class="n">iw</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">err</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">check_grad</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">dfunc</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">err</span> <span class="o">&gt;</span> <span class="mf">1e-6</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;excess err </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">ix</span><span class="p">,</span> <span class="n">iw</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Plot the total of the I-spline family shown in Fig. 1 of
<a class="reference external" href="https://www.jstor.org/stable/2245395">Ramsay (1988)</a>, adding some linear extrapolation outside the
mesh range:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">xplot</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">isplines_totalplot</span> <span class="o">=</span> <span class="n">Isplines_total</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">xplot</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">xplot</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="s1">&#39;Itotal&#39;</span><span class="p">:</span> <span class="n">isplines_totalplot</span><span class="o">.</span><span class="n">Itotal</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="mi">0</span><span class="p">)})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Itotal&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//dms_variants-ispline-2.png">png</a>, <a class="reference external" href=".//dms_variants-ispline-2.hires.png">hires.png</a>, <a class="reference external" href=".//dms_variants-ispline-2.pdf">pdf</a>)</p>
<figure class="align-default">
<img alt="_images/dms_variants-ispline-2.png" class="plot-directive" src="_images/dms_variants-ispline-2.png" />
</figure>
<dl class="py method">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines_total.Itotal">
<span class="sig-name descname"><span class="pre">Itotal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">weights</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w_lower</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/dms_variants/ispline.html#Isplines_total.Itotal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dms_variants.ispline.Isplines_total.Itotal" title="Permalink to this definition">¶</a></dt>
<dd><p>Weighted sum of spline family at points <a class="reference internal" href="#dms_variants.ispline.Isplines_total.x" title="dms_variants.ispline.Isplines_total.x"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines_total.x</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>weights</strong> (<em>array-like</em>) – Nonnegative weights <span class="math notranslate nohighlight">\(w_i\)</span> of members <span class="math notranslate nohighlight">\(I_i\)</span> of spline
family, should be of length equal to <a class="reference internal" href="#dms_variants.ispline.Isplines.n" title="dms_variants.ispline.Isplines.n"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines.n</span></code></a>.</p></li>
<li><p><strong>w_lower</strong> (<em>float</em>) – The value at the lower bound <span class="math notranslate nohighlight">\(L\)</span> of the spline range,
<span class="math notranslate nohighlight">\(w_{\rm{lower}}\)</span>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><span class="math notranslate nohighlight">\(I_{\rm{total}}\)</span> for each point in <a class="reference internal" href="#dms_variants.ispline.Isplines_total.x" title="dms_variants.ispline.Isplines_total.x"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines_total.x</span></code></a>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines_total.dItotal_dw_lower">
<span class="sig-name descname"><span class="pre">dItotal_dw_lower</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/dms_variants/ispline.html#Isplines_total.dItotal_dw_lower"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dms_variants.ispline.Isplines_total.dItotal_dw_lower" title="Permalink to this definition">¶</a></dt>
<dd><p>Deriv of <a class="reference internal" href="#dms_variants.ispline.Isplines_total.Itotal" title="dms_variants.ispline.Isplines_total.Itotal"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Isplines_total.Itotal()</span></code></a> by <span class="math notranslate nohighlight">\(w_{\rm{lower}}\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><span class="math notranslate nohighlight">\(\frac{\partial{I_{\rm{total}}}}{\partial w_{\rm{lower}}}\)</span>,
which is just one for all <a class="reference internal" href="#dms_variants.ispline.Isplines_total.x" title="dms_variants.ispline.Isplines_total.x"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines_total.x</span></code></a>.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines_total.dItotal_dweights">
<span class="sig-name descname"><span class="pre">dItotal_dweights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">weights</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w_lower</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/dms_variants/ispline.html#Isplines_total.dItotal_dweights"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dms_variants.ispline.Isplines_total.dItotal_dweights" title="Permalink to this definition">¶</a></dt>
<dd><p>Derivative of <a class="reference internal" href="#dms_variants.ispline.Isplines_total.Itotal" title="dms_variants.ispline.Isplines_total.Itotal"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Isplines_total.Itotal()</span></code></a> by <span class="math notranslate nohighlight">\(w_i\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>weights</strong> (<em>array-like</em>) – Same meaning as for <code class="xref py py-meth docutils literal notranslate"><span class="pre">Isplines.Itotal()</span></code>.</p></li>
<li><p><strong>w_lower</strong> (<em>float</em>) – Same meaning as for <code class="xref py py-meth docutils literal notranslate"><span class="pre">Isplines.Itotal()</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Array is of shape <cite>(len(x), len(weights))</cite>, and element
<cite>ix, iweight</cite> gives derivative with respect to weight
<cite>weights[iweight]</cite> at element <cite>[ix]</cite> of <a class="reference internal" href="#dms_variants.ispline.Isplines_total.x" title="dms_variants.ispline.Isplines_total.x"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines_total.x</span></code></a>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The derivative is:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{\partial I_{\rm{total}}\left(x\right)}{\partial w_i}
=
\begin{cases}
I_i\left(x\right)
 &amp; \rm{if\;} L \le x \le U, \\
I_i\left(L\right) + \left(x-L\right)
\left.\frac{\partial I_i\left(y\right)}{\partial y}\right\vert_{y=L}
 &amp; \rm{if\;} x &lt; L, \\
I_i\left(U\right) + \left(x-U\right)
\left.\frac{\partial I_i\left(y\right)}{\partial y}\right\vert_{y=U}
 &amp; \rm{if\;} x &gt; U.
\end{cases}\end{split}\]</div>
<p>Note that:</p>
<div class="math notranslate nohighlight">
\[\begin{split}I_i\left(L\right) &amp;=&amp; 0 \\
I_i\left(U\right) &amp;=&amp; 1.\end{split}\]</div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines_total.dItotal_dx">
<span class="sig-name descname"><span class="pre">dItotal_dx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">weights</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/dms_variants/ispline.html#Isplines_total.dItotal_dx"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dms_variants.ispline.Isplines_total.dItotal_dx" title="Permalink to this definition">¶</a></dt>
<dd><p>Deriv <a class="reference internal" href="#dms_variants.ispline.Isplines_total.Itotal" title="dms_variants.ispline.Isplines_total.Itotal"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Isplines_total.Itotal()</span></code></a> by <a class="reference internal" href="#dms_variants.ispline.Isplines_total.x" title="dms_variants.ispline.Isplines_total.x"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines_total.x</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Derivatives calculated from equations in <a class="reference internal" href="#dms_variants.ispline.Isplines_total.Itotal" title="dms_variants.ispline.Isplines_total.Itotal"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Isplines_total.Itotal()</span></code></a>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{\partial I_{\rm{total}}\left(x\right)}{\partial x}
=
\begin{cases}
\sum_i w_i \frac{\partial I_i\left(x\right)}{\partial x}
  &amp; \rm{if\;} L \le x \le U, \\
\left.\frac{\partial I_{\rm{total}}\left(y\right)}
           {\partial y}\right\rvert_{y=L}
  &amp; \rm{if\;} x &lt; L, \\
\left.\frac{\partial I_{\rm{total}}\left(y\right)}
           {\partial y}\right\rvert_{y=U}
  &amp; \rm{otherwise}.
\end{cases}\end{split}\]</div>
<p>Note that</p>
<div class="math notranslate nohighlight">
\[\begin{split}\left.\frac{\partial I_{\rm{total}}\left(y\right)}
           {\partial y}\right\rvert_{y=L}
 &amp;=&amp;
 \sum_i w_i \left.\frac{\partial I_i\left(y\right)}{\partial y}
            \right\rvert_{y=L}
 \\
\left.\frac{\partial I_{\rm{total}}\left(y\right)}
           {\partial y}\right\rvert_{y=U}
 &amp;=&amp;
 \sum_i w_i \left.\frac{\partial I_i\left(y\right)}{\partial y}
            \right\rvert_{y=U}\end{split}\]</div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>weights</strong> (<em>array-like</em>) – Same meaning as for <a class="reference internal" href="#dms_variants.ispline.Isplines_total.Itotal" title="dms_variants.ispline.Isplines_total.Itotal"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Isplines_total.Itotal()</span></code></a>.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Derivative <span class="math notranslate nohighlight">\(\frac{\partial I_{\rm{total}}}{\partial x}\)</span>
for each point in <a class="reference internal" href="#dms_variants.ispline.Isplines_total.x" title="dms_variants.ispline.Isplines_total.x"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Isplines_total.x</span></code></a>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="dms_variants.ispline.Isplines_total.x">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">x</span></span><a class="headerlink" href="#dms_variants.ispline.Isplines_total.x" title="Permalink to this definition">¶</a></dt>
<dd><p>Points at which spline is evaluated.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dms_variants.ispline.Msplines">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">dms_variants.ispline.</span></span><span class="sig-name descname"><span class="pre">Msplines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">order</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mesh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/dms_variants/ispline.html#Msplines"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dms_variants.ispline.Msplines" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Implements M-splines (see <a class="reference external" href="https://www.jstor.org/stable/2245395">Ramsay (1988)</a>).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>order</strong> (<em>int</em>) – Sets <a class="reference internal" href="#dms_variants.ispline.Msplines.order" title="dms_variants.ispline.Msplines.order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Msplines.order</span></code></a>.</p></li>
<li><p><strong>mesh</strong> (<em>array-like</em>) – Sets <a class="reference internal" href="#dms_variants.ispline.Msplines.mesh" title="dms_variants.ispline.Msplines.mesh"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Msplines.mesh</span></code></a>.</p></li>
<li><p><strong>x</strong> (<em>numpy.ndarray</em>) – Sets <a class="reference internal" href="#dms_variants.ispline.Msplines.x" title="dms_variants.ispline.Msplines.x"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Msplines.x</span></code></a>.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="dms_variants.ispline.Msplines.order">
<span class="sig-name descname"><span class="pre">order</span></span><a class="headerlink" href="#dms_variants.ispline.Msplines.order" title="Permalink to this definition">¶</a></dt>
<dd><p>Order of spline, <span class="math notranslate nohighlight">\(k\)</span> in notation of <a class="reference external" href="https://www.jstor.org/stable/2245395">Ramsay (1988)</a>.
Polynomials are of degree <span class="math notranslate nohighlight">\(k - 1\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dms_variants.ispline.Msplines.mesh">
<span class="sig-name descname"><span class="pre">mesh</span></span><a class="headerlink" href="#dms_variants.ispline.Msplines.mesh" title="Permalink to this definition">¶</a></dt>
<dd><p>Mesh sequence, <span class="math notranslate nohighlight">\(\xi_1 &lt; \ldots &lt; \xi_q\)</span> in the notation
of <a class="reference external" href="https://www.jstor.org/stable/2245395">Ramsay (1988)</a>. This class implements <strong>fixed</strong> mesh sequences.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dms_variants.ispline.Msplines.n">
<span class="sig-name descname"><span class="pre">n</span></span><a class="headerlink" href="#dms_variants.ispline.Msplines.n" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of members in spline, denoted as <span class="math notranslate nohighlight">\(n\)</span> in <a class="reference external" href="https://www.jstor.org/stable/2245395">Ramsay (1988)</a>.
Related to number of points <span class="math notranslate nohighlight">\(q\)</span> in the mesh and the order
<span class="math notranslate nohighlight">\(k\)</span> by <span class="math notranslate nohighlight">\(n = q - 2 + k\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dms_variants.ispline.Msplines.knots">
<span class="sig-name descname"><span class="pre">knots</span></span><a class="headerlink" href="#dms_variants.ispline.Msplines.knots" title="Permalink to this definition">¶</a></dt>
<dd><p>The knot sequence, <span class="math notranslate nohighlight">\(t_1, \ldots, t_{n + k}\)</span> in the notation of
<a class="reference external" href="https://www.jstor.org/stable/2245395">Ramsay (1988)</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dms_variants.ispline.Msplines.lower">
<span class="sig-name descname"><span class="pre">lower</span></span><a class="headerlink" href="#dms_variants.ispline.Msplines.lower" title="Permalink to this definition">¶</a></dt>
<dd><p>Lower end of interval spanned by the splines (first point in mesh).</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dms_variants.ispline.Msplines.upper">
<span class="sig-name descname"><span class="pre">upper</span></span><a class="headerlink" href="#dms_variants.ispline.Msplines.upper" title="Permalink to this definition">¶</a></dt>
<dd><p>Upper end of interval spanned by the splines (last point in mesh).</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The methods of this class cache their results and return immutable
numpy arrays. Do <strong>not</strong> make those arrays mutable and change their
values as this will lead to invalid caching.</p>
</div>
<p class="rubric">Example</p>
<p>Demonstrate and test <a class="reference internal" href="#dms_variants.ispline.Msplines" title="dms_variants.ispline.Msplines"><code class="xref py py-class docutils literal notranslate"><span class="pre">Msplines</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">functools</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">itertools</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy.optimize</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">dms_variants.ispline</span> <span class="kn">import</span> <span class="n">Msplines</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">order</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mesh</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.99999</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">msplines</span> <span class="o">=</span> <span class="n">Msplines</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">msplines</span><span class="o">.</span><span class="n">order</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">msplines</span><span class="o">.</span><span class="n">mesh</span>
<span class="go">array([0. , 0.3, 0.5, 0.6, 1. ])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">msplines</span><span class="o">.</span><span class="n">n</span>
<span class="go">6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">msplines</span><span class="o">.</span><span class="n">knots</span>
<span class="go">array([0. , 0. , 0. , 0.3, 0.5, 0.6, 1. , 1. , 1. ])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">msplines</span><span class="o">.</span><span class="n">lower</span>
<span class="go">0.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">msplines</span><span class="o">.</span><span class="n">upper</span>
<span class="go">1.0</span>
</pre></div>
</div>
<p>Evaluate the M-splines at some selected points:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">msplines</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;M</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">msplines</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">... </span>
<span class="go">M1: [10. 1.11 0.  0.   0.   0.  ]</span>
<span class="go">M2: [0.  3.73 2.4 0.6  0.   0.  ]</span>
<span class="go">M3: [0.  1.33 3.  3.67 0.   0.  ]</span>
<span class="go">M4: [0.  0.   0.  0.71 0.86 0.  ]</span>
<span class="go">M5: [0.  0.   0.  0.   3.3  0.  ]</span>
<span class="go">M6: [0.  0.   0.  0.   1.88 7.5 ]</span>
</pre></div>
</div>
<p>Check that the gradients are correct:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">xval</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">msplines</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">xval</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">xval</span><span class="p">])</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">xval</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">Msplines</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">xval</span><span class="p">)</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">dfunc</span><span class="p">(</span><span class="n">xval</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">Msplines</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">xval</span><span class="p">)</span><span class="o">.</span><span class="n">dM_dx</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">err</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">check_grad</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">dfunc</span><span class="p">,</span> <span class="n">xval</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">err</span> <span class="o">&gt;</span> <span class="mf">1e-5</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;excess err </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">xval</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Plot the M-splines in in Fig. 1 of <a class="reference external" href="https://www.jstor.org/stable/2245395">Ramsay (1988)</a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">xplot</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">msplines_plot</span> <span class="o">=</span> <span class="n">Msplines</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">xplot</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">xplot</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">msplines_plot</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;M</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">msplines_plot</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//dms_variants-ispline-3.png">png</a>, <a class="reference external" href=".//dms_variants-ispline-3.hires.png">hires.png</a>, <a class="reference external" href=".//dms_variants-ispline-3.pdf">pdf</a>)</p>
<figure class="align-default">
<img alt="_images/dms_variants-ispline-3.png" class="plot-directive" src="_images/dms_variants-ispline-3.png" />
</figure>
<dl class="py method">
<dt class="sig sig-object py" id="dms_variants.ispline.Msplines.M">
<span class="sig-name descname"><span class="pre">M</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">invalid_i</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'raise'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/dms_variants/ispline.html#Msplines.M"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dms_variants.ispline.Msplines.M" title="Permalink to this definition">¶</a></dt>
<dd><p>Evaluate spline <span class="math notranslate nohighlight">\(M_i\)</span> at point(s) <a class="reference internal" href="#dms_variants.ispline.Msplines.x" title="dms_variants.ispline.Msplines.x"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Msplines.x</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>i</strong> (<em>int</em>) – Spline member <span class="math notranslate nohighlight">\(M_i\)</span>, where <span class="math notranslate nohighlight">\(1 \le i \le\)</span>
<a class="reference internal" href="#dms_variants.ispline.Msplines.n" title="dms_variants.ispline.Msplines.n"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Msplines.n</span></code></a>.</p></li>
<li><p><strong>k</strong> (<em>int</em><em> or </em><em>None</em>) – Order of spline. If <cite>None</cite>, assumed to be <a class="reference internal" href="#dms_variants.ispline.Msplines.order" title="dms_variants.ispline.Msplines.order"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Msplines.order</span></code></a>.</p></li>
<li><p><strong>invalid_i</strong> (<em>{'raise'</em><em>, </em><em>'zero'}</em>) – If <cite>i</cite> is invalid, do we raise an error or return 0?</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The values of the M-spline at each point in <a class="reference internal" href="#dms_variants.ispline.Msplines.x" title="dms_variants.ispline.Msplines.x"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Msplines.x</span></code></a>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The spline is evaluated using the recursive relationship given by
<a class="reference external" href="https://www.jstor.org/stable/2245395">Ramsay (1988)</a>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}M_i\left(x \mid k=1\right)
&amp;=&amp;
\begin{cases}
1 / \left(t_{i+1} - t_i\right), &amp; \rm{if\;} t_i \le x &lt; t_{i+1} \\
0, &amp; \rm{otherwise}
\end{cases} \\
M_i\left(x \mid k &gt; 1\right) &amp;=&amp;
\begin{cases}
\frac{k\left[\left(x - t_i\right) M_i\left(x \mid k-1\right) +
             \left(t_{i+k} -x\right) M_{i+1}\left(x \mid k-1\right)
             \right]}
{\left(k - 1\right)\left(t_{i + k} - t_i\right)},
&amp; \rm{if\;} t_i \le x &lt; t_{i+k} \\
0, &amp; \rm{otherwise}
\end{cases}\end{split}\]</div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dms_variants.ispline.Msplines.dM_dx">
<span class="sig-name descname"><span class="pre">dM_dx</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">invalid_i</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'raise'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/dms_variants/ispline.html#Msplines.dM_dx"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dms_variants.ispline.Msplines.dM_dx" title="Permalink to this definition">¶</a></dt>
<dd><p>Derivative of <a class="reference internal" href="#dms_variants.ispline.Msplines.M" title="dms_variants.ispline.Msplines.M"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Msplines.M()</span></code></a> by to <a class="reference internal" href="#dms_variants.ispline.Msplines.x" title="dms_variants.ispline.Msplines.x"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Msplines.x</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>i</strong> (<em>int</em>) – Same as for <a class="reference internal" href="#dms_variants.ispline.Msplines.M" title="dms_variants.ispline.Msplines.M"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Msplines.M()</span></code></a>.</p></li>
<li><p><strong>k</strong> (<em>int</em><em> or </em><em>None</em>) – Same as for <a class="reference internal" href="#dms_variants.ispline.Msplines.M" title="dms_variants.ispline.Msplines.M"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Msplines.M()</span></code></a>.</p></li>
<li><p><strong>invalid_i</strong> (<em>{'raise'</em><em>, </em><em>'zero'}</em>) – Same as for <a class="reference internal" href="#dms_variants.ispline.Msplines.M" title="dms_variants.ispline.Msplines.M"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Msplines.M()</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Derivative of M-spline with respect to <a class="reference internal" href="#dms_variants.ispline.Msplines.x" title="dms_variants.ispline.Msplines.x"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Msplines.x</span></code></a>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The derivative is calculated from the equation in <a class="reference internal" href="#dms_variants.ispline.Msplines.M" title="dms_variants.ispline.Msplines.M"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Msplines.M()</span></code></a>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{\partial M_i\left(x \mid k=1\right)}{\partial x} &amp;=&amp; 0
\\
\frac{\partial M_i\left(x \mid k &gt; 1\right)}{\partial x}
&amp;=&amp;
\begin{cases}
\frac{k\left[\left(x - t_i\right)
             \frac{\partial M_i\left(x \mid k-1\right)}{\partial x}
             +
             M_i\left(x \mid k-1\right)
             +
             \left(t_{i+k} -x\right)
             \frac{\partial M_{i+1}\left(x \mid k-1\right)}
                  {\partial x}
             -
             M_{i+1}\left(x \mid k-1\right)
             \right]}
{\left(k - 1\right)\left(t_{i + k} - t_i\right)},
&amp; \rm{if\;} t_i \le x &lt; t_{i+1} \\
0, &amp; \rm{otherwise}
\end{cases}\end{split}\]</div>
</div>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="dms_variants.ispline.Msplines.x">
<em class="property"><span class="pre">property</span> </em><span class="sig-name descname"><span class="pre">x</span></span><a class="headerlink" href="#dms_variants.ispline.Msplines.x" title="Permalink to this definition">¶</a></dt>
<dd><p>Points at which spline is evaluated.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/BloomLogo.jpg" alt="Logo"/>
    
    <h1 class="logo logo-name">dms_variants</h1>
    
  </a>
</p>



<p class="blurb">Analyze deep mutational scanning of barcoded variants</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=jbloomlab&repo=dms_variants&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">dms_variants documentation</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="dms_variants.html">dms_variants package</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="dms_variants.html#dms-variants">dms_variants</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="dms_variants.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="package_index.html">package index</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgments.html">Acknowledgements</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="dms_variants.html">dms_variants package</a><ul>
      <li>Previous: <a href="dms_variants.illuminabarcodeparser.html" title="previous chapter">illuminabarcodeparser</a></li>
      <li>Next: <a href="dms_variants.pdb_utils.html" title="next chapter">pdb_utils</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019--2022.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/dms_variants.ispline.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/jbloomlab/dms_variants" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>